---
title: 检测字体支持
date: 2018-03-08 15:32:39
tags:
---
### 原理：

> 根据用户设置的字体将某一个字符绘制在canvas上（fillText()），并提取像素信息（getImageData()），然后和默认字体进行比对，如果像素不一致，说明字体生效，说明字体不生效。

```js
var isSupportFontFamily = function (fontFamily) {
        if (typeof fontFamily != 'string') {
            return false;
        }

        var defaultFontFamily = 'Arial';
        if (fontFamily.toLowerCase() == defaultFontFamily.toLowerCase()) {
            return true;
        }

        var defaultLetter = 'a';
        var defaultFontSize = 100;

        // 使用该字体绘制的canvas
        var width = 100, height = 100;
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        canvas.width = width;
        canvas.height = height;
        // 全局一致的绘制设定
        context.textAlign = 'center';
        context.fillStyle = 'black';
        context.textBaseline = 'middle';
        var getFontData = function (fontFamily) {
            // 清除
            context.clearRect(0, 0, width, height);
            // 设置字体
            context.font = defaultFontSize + 'px ' + fontFamily + ', ' + defaultFontFamily;
            context.fillText(defaultLetter, width / 2, height / 2);

            var data = context.getImageData(0, 0, width, height).data;

            return [].slice.call(data).filter(function(value) {
                return value != 0;
            });
        };

        return getFontData(defaultFontFamily).join('') !== getFontData(fontFamily).join('');
    };

    console.log(isSupportFontFamily('Arial'));
```

### 说明：

- 用一个字体显示字母a。如果这个字体不存在，系统会默认显示成Arial字体。
- 如果用字体X显示出来的字母的字符点阵和字体Arial不一样，说明字体X存在。
- 如果用字体X显示出来的字母的字符点阵和字体Arial一样，说明字体X不存在，系统用的默认字体Arial显示的。