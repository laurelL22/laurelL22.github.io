---
title: 快应用开发使用
date: 2019-08-08 18:51:46
tags:
---

### 快应用开发使用

#### 项目搭建
1. hap init project
2. cd project
3. npm install
4. npm run server
5. npm run watch   // 热更新
6. pc预览（需提前执行hap build，生成build文件;在浏览器里打开localhost:8000）
7. 支持less，安装less/less-laoder；style添加属性lang=“less"
8. 使用vscode开发，可安装插件  Hap Extension

#### 插件安装：
* Troll for UX
* Hap Extension
* beautify Quick App
* QuickApp For Highlighter


#### 样式注意：
* 文字样式需设置在文本标签上 （如：color，font-size）
* 并列样式避免嵌套.main{&.selector{}}
    - 使用并列：// .main {} .selector{}
* 叠加样式
    - 错误使用： border-bottom: 1px solid #ccc;
    - 正确使用:
        border-style: solid;
        border-bottom-color: #eaeefb;
        border-bottom-width: 1px;

#### 暂不支持的样式：
* white-space
* outline
* overflow-x/overflow-y
* clear
* display不支持block和inline-block
* user-select
* vertical-align
* 伪类 :after
* image 标签设置object-fit样式不生效


#### 问题&解决:
- 第一次执行build可能会遇到报错，解决：
    - 执行一次 hap update --force 即可解决, 再执行npm run build进行编译。
- 普通容器不支持横向滚动
    - 没有overflow的属性，只能通过tabs来hack。
    - 或者 list 组件实现横向滚动，并且 flex-direction: row;
- 动画不支持transition，只能通过animation来实现。
- absolute不支持，可以采用stack组件hack
- 在页面组件中可以通过this.$app和this.$app.$def这两个对象调用挂载到app.ux里的属性。但是注意：

app.ux中挂载的所有属性在this.$app.$def中都能获取到。但是只有方法属性会挂载到this.$app上。
- js设置网络背景图用法：
    ```js
    {
        backgroundImage: this.lotteryProp.cover
    }
    ```

- 访问子组件
    - this.$child('id')
- 访问父组件
    - this.$parent()

- computed 里可以访问 this.$app 全局属性，data选项里不可以访问全局属性

- 页面回退，不刷新页面， 只是回退

- 不能动态设置背景渐变色
    ```js
        data: {
            bgStyle: {
                background: 'linear-gradient(to right bottom,rgb(255, 0, 0), rgb(0, 0, 255))'
            }
        }
    ```

- show 属性值必须为Boolean类型，否则不生效。

    - 比如，下面的dom会渲染节点 【undefined】
    ```html
        <text show="{{ leaf.name }}" class="tab-content__header">{{ leaf.name }}</text>
    ```
    - 改成这样的就不会渲染出来
    ```html
        <text show="{{ !!leaf.name }}" class="tab-content__header">{{ leaf.name }} hhh</text>
    ```

- 用canvas绘制图片（new Image() 在 canvas.getContext('2d')之前调用）
    ```js
        drawCanvas() {
            const canvas = this.$element('canvasid')

            const ctx = canvas.getContext('2d')

            const img = new Image() // new Image() 在 canvas.getContext('2d')之前调用

            console.log('img', img)

            // img.src = 'https://www.quickapp.cn/assets/images/home/logo.png'
            img.src = '/Common/images/840.jpeg'

            //加载成功的回调
            img.onload = () => {
                console.log('图片加载完成')
                ctx.drawImage(img, 0, 0)
            }

            //加载失败的回调
            img.onerror = (e) => {
                console.log('图片加载失败', e)
            }
        }
    ```

- 签名文件生成

    - 命令行：`openssl req -newkey rsa:2048 -nodes -keyout private.pem -x509 -days 3650 -out certificate.pem`
    - 回车，随意输入内容即可
    - sign 目录下创建 release 目录，将私钥文件 private.pem 和证书文件 certificate.pem 拷贝进去


#### 最佳实践

- promise 化快应用小程序

```js
/**
 * promise 化快应用小程序
 * @param {*} actions 
 * @param {*} option 
 */

const prompt = require('@system.prompt');

const router = require('@system.router');

const media = require('@system.media');

const request = require('@system.request');

const image = require('@system.image');
const Native = { // 自行添加项目里所需要的接口
    prompt,
    router,
    request,
    media,
    image
}

function nativeApi(actions, option) {
  const [action, name] = actions.split('.');

  return new Promise((resolve, reject) => 
    Native[action][name](Object.assign({}, option, {
      success: resolve, fail: reject
    }))
  )
}
```
